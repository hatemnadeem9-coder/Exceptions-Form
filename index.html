<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exceptions Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .readonly-input {
            background-color: #f3f4f6; /* gray-100 */
            cursor: not-allowed;
        }
        .warning-bg {
            background-color: #fef9c3; /* yellow-100 */
            border-color: #fde047; /* yellow-300 */
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4 sm:p-6 lg:p-8">

    <div class="w-full max-w-4xl">
        <div id="form-container" class="bg-white p-6 sm:p-8 rounded-xl shadow-lg border border-gray-200 fade-in">
            <div class="mb-6 text-center">
                <h1 class="text-3xl font-bold text-gray-800">Exceptions Form</h1>
                <p class="text-gray-500 mt-2">Please fill out the details for your Exception request below.</p>
            </div>
            
            <form id="event-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="agent-id" class="block text-sm font-medium text-gray-700 mb-1">ID</label>
                        <input type="text" id="agent-id" list="agent-id-list" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" placeholder="Type to search for ID...">
                        <datalist id="agent-id-list">
                            </datalist>
                    </div>
                    <div>
                        <label for="agent-name" class="block text-sm font-medium text-gray-700 mb-1">Agent Name</label>
                        <input type="text" id="agent-name" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg readonly-input">
                    </div>
                    <div>
                        <label for="team-leader" class="block text-sm font-medium text-gray-700 mb-1">Team Leader</label>
                        <input type="text" id="team-leader" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg readonly-input">
                    </div>
                     <div>
                        <label for="hr-code" class="block text-sm font-medium text-gray-700 mb-1">HR Code</label>
                        <input type="text" id="hr-code" readonly class="w-full px-4 py-2 border border-gray-300 rounded-lg readonly-input">
                    </div>
                </div>

                <div class="space-y-4 mb-6" id="date-time-section">
                    <h2 class="text-xl font-semibold text-gray-700 border-b pb-2">Activity Details</h2>
                    </div>

                <div class="flex items-center gap-4 mb-8">
                    <button type="button" id="add-date-btn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition shadow-sm">
                        Add Entry
                    </button>
                    <p id="date-counter" class="text-sm text-gray-500"></p>
                </div>

                <div class="text-center">
                    <button type="submit" id="submit-btn" class="w-full md:w-auto bg-green-600 text-white font-bold py-3 px-12 rounded-lg hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-transform transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                        Submit
                    </button>
                </div>
            </form>
            <div class="text-center border-t border-gray-200 pt-4 mt-8">
                <p class="text-base text-orange-500 font-semibold">By : Hatem Medhat - WFM Team</p>
            </div>
        </div>

        <div id="submission-status-container" class="hidden bg-white p-8 rounded-xl shadow-lg border border-gray-200 fade-in text-center">
             <div id="loading-spinner" class="spinner mx-auto mb-4"></div>
             <h2 id="status-heading" class="text-2xl font-bold text-gray-800">Submitting...</h2>
             <p id="status-message" class="text-gray-600 mt-2">Please wait while we send your activity details.</p>
             <div class="text-center mt-8">
                <button id="new-form-btn" class="hidden bg-gray-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500 transition shadow-sm">
                    Submit Another Response
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // EDITED: Updated agentsData array with the new information.
           const agentsData = [
  {id: "X2098692", hrCode: "844976", tl: "Youhana", agentName: "Nermeen Mohamed"},
  {id: "X2098690", hrCode: "844975", tl: "Youhana", agentName: "Sabah Hassan"},
  {id: "X2098689", hrCode: "844974", tl: "Youhana", agentName: "Alshimaa Hassan"},
  {id: "X2040719", hrCode: "835792", tl: "Youhana", agentName: "Ebtesam Mahrous"},
  {id: "X2100111", hrCode: "844985", tl: "Youhana", agentName: "Alaa Hamdy"},
  {id: "X2077124", hrCode: "842553", tl: "Youhana", agentName: "Farah Atef"},
  {id: "X2048908", hrCode: "838909", tl: "Youhana", agentName: "Rania Abdelsalam"},
  {id: "X2122168", hrCode: "851027", tl: "Youhana", agentName: "Sama Mohamed"},
  {id: "X1220742", hrCode: "819889", tl: "Youhana", agentName: "Marwa Ashraf"},
  {id: "YEG002272", hrCode: "40544", tl: "Youhana", agentName: "Al Shaymaa Ahmed"},
  {id: "YEG002733", hrCode: "40541", tl: "Youhana", agentName: "Elham Abdulsalam"},
  {id: "X783265", hrCode: "40681", tl: "Youhana", agentName: "Lama Nabil"},
  {id: "X2094364", hrCode: "844963", tl: "Youhana", agentName: "Mahmoud Rashad"},
  {id: "X2046109", hrCode: "837345", tl: "Youhana", agentName: "Manal Mohamed"},
  {id: "X2015516", hrCode: "827882", tl: "Youhana", agentName: "Maram Mohamed"},
  {id: "X1387129", hrCode: "824284", tl: "Youhana", agentName: "Mohamed Ismail"},
  {id: "X2082090", hrCode: "843495", tl: "Youhana", agentName: "Nesma mohamed"},
  {id: "X1387120", hrCode: "824286", tl: "Youhana", agentName: "Samar Mohamed"},
  {id: "X1310300", hrCode: "823203", tl: "Youhana", agentName: "Sihar Ashraf"},
  {id: "X2047644", hrCode: "838870", tl: "Youhana", agentName: "Sohaila Abd Elwahed"},
  {id: "X2043494", hrCode: "837344", tl: "Youhana", agentName: "Sohila Elsayed"},
  {id: "X2141339", hrCode: "851056", tl: "Youhana", agentName: "Noha Samir"},
  {id: "X2147218", hrCode: "851101", tl: "Youhana", agentName: "Rowida Ramadan"},
  {id: "X2144479", hrCode: "851083", tl: "Youhana", agentName: "Kamal mohamed Ibrahim ghonem"},
  {id: "X2145008", hrCode: "851087", tl: "Youhana", agentName: "Hagar Youssef"},
  {id: "X2148373", hrCode: "854355", tl: "Youhana", agentName: "Abdelrahman Tawfik"},
  {id: "X2113264", hrCode: "848172", tl: "Assem Alaa", agentName: "Hazem Ahmed"},
  {id: "X2100110", hrCode: "844984", tl: "Assem Alaa", agentName: "Eman Marey"},
  {id: "X2113277", hrCode: "848177", tl: "Assem Alaa", agentName: "Kareem Adel"},
  {id: "X2160031", hrCode: "854386", tl: "Assem Alaa", agentName: "Ayman Gomaa"},
  {id: "X2129213", hrCode: "851017", tl: "Assem Alaa", agentName: "Farah Soror"},
  {id: "X2129219", hrCode: "851019", tl: "Assem Alaa", agentName: "Abdullah Sayed"},
  {id: "X2129214", hrCode: "851020", tl: "Assem Alaa", agentName: "Omaima Elghazawi"},
  {id: "X2136419", hrCode: "851035", tl: "Assem Alaa", agentName: "Soha Khashana"},
  {id: "X1190822", hrCode: "817650", tl: "Assem Alaa", agentName: "Dalia Khaled"},
  {id: "X2079591", hrCode: "842571", tl: "Assem Alaa", agentName: "Nariman Medhat"},
  {id: "X2082073", hrCode: "842576", tl: "Assem Alaa", agentName: "Abdullah Hesham"},
  {id: "X2113272", hrCode: "848174", tl: "Assem Alaa", agentName: "Islam Zain"},
  {id: "X2108396", hrCode: "848183", tl: "Assem Alaa", agentName: "Yasmin Hani"},
  {id: "X2136422", hrCode: "851036", tl: "Assem Alaa", agentName: "Abdelrahman Rafaat"},
  {id: "X2136421", hrCode: "851037", tl: "Assem Alaa", agentName: "Abdullah Hesham Ibrahim"},
  {id: "X2136420", hrCode: "851038", tl: "Assem Alaa", agentName: "Ahmed Omeir"},
  {id: "X2155211", hrCode: "854374", tl: "Assem Alaa", agentName: "Somaia Selim"},
  {id: "X1310561", hrCode: "823201", tl: "Assem Alaa", agentName: "Mostafa Darwish"},
  {id: "X2002023", hrCode: "825803", tl: "Assem Alaa", agentName: "Shorouk Anwar"},
  {id: "X2113274", hrCode: "848176", tl: "Assem Alaa", agentName: "Safa Mahamoud"},
  {id: "X2151235", hrCode: "854357", tl: "Assem Alaa", agentName: "Hesham Omar"},
  {id: "X2113283", hrCode: "848179", tl: "Assem Alaa", agentName: "Aya Essam"},
  {id: "X2176143", hrCode: "858683", tl: "Assem Alaa", agentName: "Abdelrahman hesham"},
  {id: "X2176145", hrCode: "858685", tl: "Assem Alaa", agentName: "Mohamed Mostafa"},
  {id: "X2176146", hrCode: "858686", tl: "Assem Alaa", agentName: "Mostafa Gamal"},
  {id: "X2176147", hrCode: "858687", tl: "Assem Alaa", agentName: "Ali Refaat"}, 
  {id: "X2168034", hrCode: "856523", tl: "Assem Alaa", agentName: "Alaa Zakaria"},   
  {id: "X2168034", hrCode: "856522", tl: "Assem Alaa", agentName: "Mohamed Heshmat"},                
  {id: "X2168030", hrCode: "824300", tl: "Assem Alaa", agentName: "Nourallah Salah"},
  {id: "X1205780", hrCode: "40690", tl: "Assem Alaa", agentName: "Aya Fathi"},
  {id: "X2100096", hrCode: "844978", tl: "Assem Alaa", agentName: "Yara Hassan"},
  {id: "X2113281", hrCode: "848178", tl: "Assem Alaa", agentName: "Ahmed El Saqqa"},
  {id: "X880841", hrCode: "40744", tl: "Assem Alaa", agentName: "Mahmoud Omar"},
  {id: "X2082072", hrCode: "842575", tl: "Assem Alaa", agentName: "Abanoub William"},
  {id: "X2002020", hrCode: "825801", tl: "Assem Alaa", agentName: "Muhammad Hosny"},
  {id: "X1075901", hrCode: "40986", tl: "Kirolos Gamil", agentName: "Nourhan Salah Sayed"},
  {id: "X1160361", hrCode: "817341", tl: "Kirolos Gamil", agentName: "Sohila Mahmoud"},          
  {id: "X1325800", hrCode: "823221", tl: "Kirolos Gamil", agentName: "Maha Muhammad"},
  {id: "X2017209", hrCode: "830209", tl: "Kirolos Gamil", agentName: "Suzan Magdy"},
  {id: "X2027633", hrCode: "832336", tl: "Kirolos Gamil", agentName: "Abd-Elrahman Adel Mohamed"},
  {id: "X2040351", hrCode: "835769", tl: "Kirolos Gamil", agentName: "Amani Assem"},
  {id: "X2046113", hrCode: "837347", tl: "Kirolos Gamil", agentName: "Mohamed Hamed Atya"},
  {id: "X2047645", hrCode: "838869", tl: "Kirolos Gamil", agentName: "Bassant Beshara Nasif"},
  {id: "X2047646", hrCode: "838866", tl: "Kirolos Gamil", agentName: "Fayrouz Fanos Fahim"},
  {id: "X2047656", hrCode: "838865", tl: "Kirolos Gamil", agentName: "Abdel Aaziz Ashraf"},
  {id: "X2065278", hrCode: "838918", tl: "Kirolos Gamil", agentName: "Mahmoud Ahmed"},
  {id: "X2082076", hrCode: "843488", tl: "Kirolos Gamil", agentName: "Dina Atef"},
  {id: "X2082079", hrCode: "843490", tl: "Kirolos Gamil", agentName: "Esraa Ebrahim"},
  {id: "X2082088", hrCode: "843493", tl: "Kirolos Gamil", agentName: "Mayer Ismail"},
  {id: "X2082095", hrCode: "843497", tl: "Kirolos Gamil", agentName: "Yostina Hany"},
  {id: "X2089012", hrCode: "844970", tl: "Kirolos Gamil", agentName: "Rana Shawky"},
  {id: "X2089355", hrCode: "844911", tl: "Kirolos Gamil", agentName: "Sherin Sayed"},
  {id: "X2090310", hrCode: "844971", tl: "Kirolos Gamil", agentName: "Yara Emad"},
  {id: "X2091475", hrCode: "844909", tl: "Kirolos Gamil", agentName: "Ahmed Elmohamdi"},
  {id: "X2094368", hrCode: "844965", tl: "Kirolos Gamil", agentName: "Amal Ahmed"},
  {id: "X2108397", hrCode: "848192", tl: "Kirolos Gamil", agentName: "Nermine Elfeki"},
  {id: "X2122166", hrCode: "851055", tl: "Kirolos Gamil", agentName: "Nada Hamada"},
  {id: "X2141348", hrCode: "851051", tl: "Kirolos Gamil", agentName: "Mariam Nasser"},
  {id: "X2141349", hrCode: "851049", tl: "Kirolos Gamil", agentName: "Ibrahim Mamdouh"},
  {id: "X2141350", hrCode: "851052", tl: "Kirolos Gamil", agentName: "Mohammed Ebrahim"},
  {id: "X2141356", hrCode: "851047", tl: "Kirolos Gamil", agentName: "Filopateer Boshra"},
  {id: "X2142026", hrCode: "851050", tl: "Kirolos Gamil", agentName: "Mahrail Maged"},
  {id: "X2144481", hrCode: "851084", tl: "Kirolos Gamil", agentName: "Sondos Saleh"},
  {id: "X2148372", hrCode: "854354", tl: "Kirolos Gamil", agentName: "Shaimaa Tarek"},
  {id: "X2151365", hrCode: "854358", tl: "Kirolos Gamil", agentName: "Salma El Rashidy"},
  {id: "X2151367", hrCode: "854359", tl: "Kirolos Gamil", agentName: "Hager Hussien"},
  {id: "X2151369", hrCode: "854361", tl: "Kirolos Gamil", agentName: "Sama Ehab"},
  {id: "X614369", hrCode: "40571", tl: "Kirolos Gamil", agentName: "David Emad"},
  {id: "X626980", hrCode: "40583", tl: "Kirolos Gamil", agentName: "Silvana Emad"},
  {id: "X722281", hrCode: "40369", tl: "Kirolos Gamil", agentName: "Mina Ezat Louis"},
  {id: "X723901", hrCode: "40628", tl: "Kirolos Gamil", agentName: "Mosaab Ali"},
  {id: "X822440", hrCode: "40702", tl: "Kirolos Gamil", agentName: "Mahmoud Gamal"},
  {id: "YEG002235", hrCode: "40516", tl: "Kirolos Gamil", agentName: "Tamer Refaei"},
  {id: "X2003111", hrCode: "825811", tl: "Maher", agentName: "Abanoub Makram"},
  {id: "X1387122", hrCode: "824283", tl: "Maher", agentName: "Abdallah tarek"},
  {id: "X1370543", hrCode: "824262", tl: "Maher", agentName: "Alaa Tariq"},
  {id: "X2079589", hrCode: "842569", tl: "Maher", agentName: "Anoud Mohamed"},
  {id: "X1325780", hrCode: "823219", tl: "Maher", agentName: "Dina Ahmed"},
  {id: "X2040350", hrCode: "835770", tl: "Maher", agentName: "Elarya Atef"},
  {id: "X1277023", hrCode: "821322", tl: "Maher", agentName: "Eman Hosny"},
  {id: "X1370544", hrCode: "824263", tl: "Maher", agentName: "Enas Adel"},
  {id: "X1264181", hrCode: "821315", tl: "Maher", agentName: "Esraa Ahmed"},
  {id: "X2068123", hrCode: "838920", tl: "Maher", agentName: "Lamiaa Essam"},
  {id: "X2144482", hrCode: "851085", tl: "Maher", agentName: "Hagar Abdullah"},
  {id: "X2082080", hrCode: "843491", tl: "Maher", agentName: "Hagar Magdy"},
  {id: "X1264162", hrCode: "821317", tl: "Maher", agentName: "Shimaa Muhammed"},
  {id: "X1277025", hrCode: "821324", tl: "Maher", agentName: "Mahmoud Ibrahim"},
  {id: "X2100108", hrCode: "844982", tl: "Maher", agentName: "Malak Abd EL Nasser"},
  {id: "X1160340", hrCode: "817339", tl: "Maher", agentName: "Moamen Sami"},
  {id: "X2002022", hrCode: "825802", tl: "Maher", agentName: "Nourhan Muhammad"},
  {id: "X2141359", hrCode: "851045", tl: "Maher", agentName: "Rawan Ismail"},
  {id: "X2147221", hrCode: "854352", tl: "Maher", agentName: "Hadeer Fathy"},
  {id: "X2002027", hrCode: "819888", tl: "Maher", agentName: "Sarah Fakhry"},
  {id: "X2089357", hrCode: "844913", tl: "Maher", agentName: "Rehan Mostafa"},
  {id: "X2079590", hrCode: "842570", tl: "Maher", agentName: "Shorouk Sayed"},
  {id: "X626981", hrCode: "40586", tl: "Maher", agentName: "Triza Saber"},
  {id: "X2090314", hrCode: "844972", tl: "Maher", agentName: "Yasmine Ezz"},
  {id: "X2100111", hrCode: "844985", tl: "Hamed", agentName: "Alaa Hamdy"},
  {id: "X1285441", hrCode: "821337", tl: "Hamed", agentName: "Mayada Ali"},
  {id: "X1325802", hrCode: "823222", tl: "Hamed", agentName: "Amr Ahmad"},
  {id: "X1277043", hrCode: "821327", tl: "Hamed", agentName: "Aya Rajab"},
  {id: "X2158179", hrCode: "854393", tl: "Hamed", agentName: "Bassant Samir"},
  {id: "X2158180", hrCode: "856519", tl: "Hamed", agentName: "Demiana Soliman"},
  {id: "X2043492", hrCode: "837343", tl: "Hamed", agentName: "Doaa Ahmed"},
  {id: "X2155246", hrCode: "854378", tl: "Hamed", agentName: "Esraa Madian"},
  {id: "X2158178", hrCode: "854392", tl: "Hamed", agentName: "Esraa Ragab"},
  {id: "X2077124", hrCode: "842553", tl: "Hamed", agentName: "Farah Atef"},
  {id: "X2158177", hrCode: "854391", tl: "Hamed", agentName: "Habeba Gharib"},
  {id: "X2158175", hrCode: "854389", tl: "Hamed", agentName: "Hager Atef"},
  {id: "YEG003047", hrCode: "40562", tl: "Hamed", agentName: "Hesham Yousry"},
  {id: "X2082078", hrCode: "843489", tl: "Hamed", agentName: "Islam Ahmed"},
  {id: "X788262", hrCode: "40687", tl: "Hamed", agentName: "Islam Seyam"},
  {id: "X1002723", hrCode: "40893", tl: "Hamed", agentName: "Maha Tarek"},
  {id: "X2100128", hrCode: "854377", tl: "Hamed", agentName: "Mariam Salama"},
  {id: "X2158176", hrCode: "854390", tl: "Hamed", agentName: "Marlen Mamdouh"},
  {id: "X2122169", hrCode: "851026", tl: "Hamed", agentName: "Martina Nabil"},
  {id: "X2166018", hrCode: "856520", tl: "Hamed", agentName: "mennatallah Ali"},
  {id: "X2002024", hrCode: "825804", tl: "Hamed", agentName: "Mina Melad"},
  {id: "X1059943", hrCode: "40951", tl: "Hamed", agentName: "Mohamed Elbarbary"},
  {id: "X2125152", hrCode: "851004", tl: "Hamed", agentName: "Nada Mohamed"},
  {id: "X2158181", hrCode: "854394", tl: "Hamed", agentName: "Nahla Ahmed"},
  {id: "X2126210", hrCode: "851007", tl: "Hamed", agentName: "Nour Hussein"},
  {id: "X2048908", hrCode: "838909", tl: "Hamed", agentName: "Rania Abdelsalam"},
  {id: "X774963", hrCode: "40668", tl: "Hamed", agentName: "Reham nabil"},
  {id: "X2125151", hrCode: "851003", tl: "Hamed", agentName: "Rowaida Elsayed"},
  {id: "X738720", hrCode: "40657", tl: "Hamed", agentName: "Saad Zakria"},
  {id: "YEG003051", hrCode: "40869", tl: "Hamed", agentName: "Sara sayed"},
  {id: "X2089010", hrCode: "848194", tl: "Hamed", agentName: "Sondos Ahmed"},
  {id: "X2125150", hrCode: "851006", tl: "Hamed", agentName: "Yara Ahmed"},
  {id: "X2125153", hrCode: "851005", tl: "Hamed", agentName: "Yasmin Ahmed"},
  {id: "X2149084", hrCode: "856513", tl: "Rasha", agentName: "Merna William"},
  {id: "X2170210", hrCode: "856533", tl: "Rasha", agentName: "Hager Khalid"},             
  {id: "X1264180", hrCode: "821313", tl: "Hamed", agentName: "Ali Ashraf"},             
  {id: "X2176327", hrCode: "858672", tl: "Youhana", agentName: "Shahinz Emad"},             
  {id: "X2176346", hrCode: "858674", tl: "Youhana", agentName: "Mohamed Ewis"},             
  {id: "X2176331", hrCode: "858677", tl: "Youhana", agentName: "Rawan Ahmed"},             
  {id: "X2176332", hrCode: "858678", tl: "Youhana", agentName: "Abdalla Rabie"},
   {id: "X2177318", hrCode: "123456", tl: "Rasha", agentName: "Hassan Salaheldin"},            
  {id: "X2176333", hrCode: "858679        ", tl: "Youhana", agentName: "Naira Khaled"}
];

            // --- DOM Element References ---
            const form = document.getElementById('event-form');
            const agentIdInput = document.getElementById('agent-id');
            const agentNameInput = document.getElementById('agent-name');
            const hrCodeInput = document.getElementById('hr-code');
            const teamLeaderInput = document.getElementById('team-leader');
            const dateTimeSection = document.getElementById('date-time-section');
            const addDateBtn = document.getElementById('add-date-btn');
            const dateCounter = document.getElementById('date-counter');
            const formContainer = document.getElementById('form-container');
            const newFormBtn = document.getElementById('new-form-btn');
            const statusContainer = document.getElementById('submission-status-container');
            const statusHeading = document.getElementById('status-heading');
            const statusMessage = document.getElementById('status-message');
            const loadingSpinner = document.getElementById('loading-spinner');

            // !!! IMPORTANT: THIS URL SHOULD BE YOUR GOOGLE APPS SCRIPT URL !!!
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxr1ZQK6pb_wFriC9d32ArsfhU0noqTW-O7seo3zd4FoJ4jjGlR1fPyOQBV1zqCOiy76A/exec";

            const MAX_ENTRIES = 10;
            let entryCount = 0;

            // --- Functions ---
            const populateIds = () => {
                const dataList = document.getElementById('agent-id-list');
                agentsData.forEach(agent => {
                    const option = document.createElement('option');
                    option.value = agent.id;
                    dataList.appendChild(option);
                });
            };

            const handleIdChange = (e) => {
                const selectedId = e.target.value;
                const selectedAgent = agentsData.find(agent => agent.id.toLowerCase() === selectedId.toLowerCase());

                if (selectedAgent) {
                    agentNameInput.value = selectedAgent.agentName;
                    hrCodeInput.value = selectedAgent.hrCode;
                    teamLeaderInput.value = selectedAgent.tl;
                } else {
                    agentNameInput.value = '';
                    hrCodeInput.value = '';
                    teamLeaderInput.value = '';
                }
            };

            const updateEntryCounter = () => {
                dateCounter.textContent = `${entryCount} of ${MAX_ENTRIES} entries added.`;
                addDateBtn.disabled = entryCount >= MAX_ENTRIES;
                addDateBtn.classList.toggle('opacity-50', entryCount >= MAX_ENTRIES);
                addDateBtn.classList.toggle('cursor-not-allowed', entryCount >= MAX_ENTRIES);
            };

            const addDateTimeEntry = () => {
                if (entryCount >= MAX_ENTRIES) return;
                entryCount++;

                const entryId = `date-entry-${entryCount}`;
                const entryDiv = document.createElement('div');
                entryDiv.className = 'p-4 border rounded-lg bg-gray-50 fade-in space-y-4';
                entryDiv.id = entryId;
                
                const today = new Date().toISOString().split('T')[0];

                entryDiv.innerHTML = `
                    <div class="flex justify-between items-center">
                        <h3 class="font-semibold text-gray-600">Entry #${entryCount}</h3>
                        ${entryCount > 1 ? `<button type="button" class="remove-date-btn text-red-500 hover:text-red-700 font-semibold text-sm" data-target="${entryId}">Remove</button>` : ''}
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label for="exception-type-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">Exception Type</label>
                            <select id="exception-type-${entryCount}" name="exception-type" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500">
                                <option value="" disabled selected>Select a Type</option>
                                <option value="Follow up">Follow up</option>
                                <option value="Meeting">Meeting</option>
                                <option value="Shadowing">Shadowing</option>
                                <option value="Happy Call">Happy Call</option>
                                <option value="Task">Task</option>
                                <option value="Technical issue">Technical issue</option>
                                <option value="Training">Training</option>
                                <option value="Support">Support</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label for="exception-reason-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">Exception Reason</label>
                            <textarea id="exception-reason-${entryCount}" name="exception-reason" rows="1" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500"></textarea>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 pt-2">
                        <div>
                            <label for="date-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="date-${entryCount}" name="event-date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500" value="${today}">
                        </div>
                        <div>
                            <label for="time-from-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">From</label>
                            <input type="time" id="time-from-${entryCount}" name="time-from" required class="time-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="time-to-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">To</label>
                            <input type="time" id="time-to-${entryCount}" name="time-to" required class="time-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500">
                        </div>
                        <div>
                            <label for="duration-${entryCount}" class="block text-sm font-medium text-gray-700 mb-1">Duration</label>
                            <input type="text" id="duration-${entryCount}" name="duration" readonly class="duration-output w-full px-3 py-2 border border-gray-200 rounded-lg readonly-input transition-colors">
                        </div>
                    </div>
                `;
                dateTimeSection.appendChild(entryDiv);
                updateEntryCounter();
                
                if (entryCount > 1) {
                    entryDiv.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            };
            
            const calculateDuration = (timeFrom, timeTo) => {
                if (!timeFrom || !timeTo) return { text: '', isWarning: false };
                
                const from = new Date(`1970-01-01T${timeFrom}:00`);
                const to = new Date(`1970-01-01T${timeTo}:00`);
                let diff = to.getTime() - from.getTime();
                let isWarning = false;

                if (diff < 0) {
                    const durationOvernight = (diff + 24 * 60 * 60 * 1000) / (1000 * 60 * 60);
                    
                    if (durationOvernight > 12) {
                        isWarning = true;
                    }
                    diff += 24 * 60 * 60 * 1000;
                }

                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                
                return {
                    text: `${hours}h ${minutes}m`,
                    isWarning: isWarning
                };
            };

            const handleFormSubmit = async (e) => {
                e.preventDefault();
                if (SCRIPT_URL === "Please paste your Google Apps Script URL into the SCRIPT_URL constant in the HTML file.") {
                    alert("Please paste your Google Apps Script URL into the SCRIPT_URL constant in the HTML file.");
                    return;
                }

                formContainer.classList.add('hidden');
                statusContainer.classList.remove('hidden');
                loadingSpinner.style.display = 'block';
                statusHeading.textContent = 'Submitting...';
                statusMessage.textContent = 'Please wait while we send your activity details.';
                newFormBtn.classList.add('hidden');

                const baseData = {
                    agentId: document.getElementById('agent-id').value,
                    agentName: document.getElementById('agent-name').value,
                    teamLeader: document.getElementById('team-leader').value,
                    hrCode: document.getElementById('hr-code').value,
                };
                
                const entriesData = [];
                const dateEntries = document.querySelectorAll('[id^="date-entry-"]');

                dateEntries.forEach(entry => {
                    const entryNumber = entry.id.split('-')[2];
                    const exceptionType = entry.querySelector(`#exception-type-${entryNumber}`).value;
                    const exceptionReason = entry.querySelector(`#exception-reason-${entryNumber}`).value;
                    const date = entry.querySelector(`#date-${entryNumber}`).value;
                    const timeFrom = entry.querySelector(`#time-from-${entryNumber}`).value;
                    const timeTo = entry.querySelector(`#time-to-${entryNumber}`).value;
                    const duration = entry.querySelector(`#duration-${entryNumber}`).value;

                    if (date && timeFrom && timeTo) {
                        entriesData.push({ ...baseData, exceptionType, exceptionReason, date, timeFrom, timeTo, duration });
                    }
                });
                
                try {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        cache: 'no-cache',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(entriesData),
                        redirect: 'follow'
                    });

                    loadingSpinner.style.display = 'none';
                    statusHeading.textContent = 'Submission Successful!';
                    statusMessage.textContent = 'Your activity has been recorded in the Google Sheet.';
                } catch (error) {
                    console.error('Error submitting form:', error);
                    loadingSpinner.style.display = 'none';
                    statusHeading.textContent = 'Submission Failed';
                    statusMessage.textContent = 'An error occurred. Please try again.';
                } finally {
                    newFormBtn.classList.remove('hidden');
                }
            };
            
            const resetFormView = () => {
                form.reset();
                const title = dateTimeSection.querySelector('h2');
                dateTimeSection.innerHTML = '';
                if(title) dateTimeSection.appendChild(title);
                
                agentNameInput.value = '';
                hrCodeInput.value = '';
                teamLeaderInput.value = '';
                entryCount = 0;
                addDateTimeEntry();
                statusContainer.classList.add('hidden');
                formContainer.classList.remove('hidden');
            };

            // --- Event Listeners ---
            agentIdInput.addEventListener('input', handleIdChange);
            addDateBtn.addEventListener('click', addDateTimeEntry);

            dateTimeSection.addEventListener('click', (e) => {
                if (e.target.classList.contains('remove-date-btn')) {
                    const targetId = e.target.dataset.target;
                    document.getElementById(targetId)?.remove();
                    entryCount--;
                    updateEntryCounter();
                }
            });

            dateTimeSection.addEventListener('input', (e) => {
                 if (e.target.classList.contains('time-input')) {
                    const parentEntry = e.target.closest('[id^="date-entry-"]');
                    const timeFromValue = parentEntry.querySelector('input[name="time-from"]').value;
                    const timeToValue = parentEntry.querySelector('input[name="time-to"]').value;
                    const durationOutput = parentEntry.querySelector('.duration-output');
                    
                    const durationData = calculateDuration(timeFromValue, timeToValue);
                    durationOutput.value = durationData.text;

                    if (durationData.isWarning) {
                        durationOutput.classList.add('warning-bg');
                    } else {
                        durationOutput.classList.remove('warning-bg');
                    }
                 }
            });

            form.addEventListener('submit', handleFormSubmit);
            newFormBtn.addEventListener('click', resetFormView);

            // --- Initial Setup ---
            populateIds();
            addDateTimeEntry();
        });
    </script>
</body>
</html>




















